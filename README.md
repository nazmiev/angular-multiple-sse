# описание задачи

У нас проект трекер процессов предприятий.

Когда потребовалась интерактивность во фронтенд-приложении,
мы пошли смотреть что сейчас используют и что модно.

Кроме websocket появился только SSE.

Еще SSE активно использовался в YouTrack, 
который мы использовали для трекинга всех задач в компании.

Выбор пал на него.

## особенности SSE:

- односторонняя связь
- ограниченное количество подключений: для HTTP вроде шесть, а для HTTPS много, но всё равно ограничено
- все рекомендуют дополнительную защиту

У нас не требуется двусторонняя связь.

У нас HTTPS.

А вот для защиты нужно было поискать лучшие практики.

## дополнительная защита

Решили что для подключения к SSE клиент должен получить одноразовый токен,
который действует пять секунд.

И в разных компонентах мы будем использовать разные SSE потоки.

Именно эти два решения привели к сложной логике с очередями на подключение и на отключение.

Возможно, лучше было сделать одну общую шину данных для пользователя,
а уже на фронте выцеплять нужные данные для каждого компонента.

Мы об этом часто вспоминаем со словами "да, надо сделать уже"

## реализация

Создал абстрактный класс EventService с основной логикой и методами.

Создал классы для компонентов.

Для наглядности создал репозиторий с Angular проектом.

Но, по-сути статьи, нам интересен только этот файл: https://github.com/nazmiev/angular-multiple-sse/blob/master/src/app/services/event-source.service.ts

В котором вся логика очереди подключений.

## заключение

Если вам не нужна двусторонняя связь.

И вы решили использовать SSE.

Шлите все данные в одно подключение.

Изоляция тут особо не нужна.

А проблем доставляет кучу)

## Live demo SSE:

https://nazmiev.github.io/angular-multiple-sse/